name: ROS Melodic CI
on: 
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
    
  schedule:
    - cron:  '0 0 * * *' # at the end of every day
jobs:    
  build:
    runs-on: ubuntu-18.04
    container: ros:melodic-robot
    steps:
      - uses: actions/checkout@v1
      - name: Install catkin & package dependencies
        run: |
          apt-get update
          apt-get install -y python-pip
          apt-get install -y ros-melodic-catkin python-catkin-tools
          apt-get install -qy g++ libeigen3-dev
          rosdep update
          rosdep install --from-paths . --ignore-src -y -r --as-root apt:false
      - name: Setup catkin workspace
        run: |
          mkdir -p ~/catkin_ws/src
          cd ~/catkin_ws/src
          cp -r $GITHUB_WORKSPACE .
          cd ~/catkin_ws/
          catkin init
          catkin config --extend /opt/ros/melodic
          catkin config -DCMAKE_BUILD_TYPE=Release                    
      - name: Build package
        run: |
          cd ~/catkin_ws
          export LDFLAGS="-Wl,-O1,--sort-common,--as-needed,--no-undefined,-z,relro,-z,now -pthread"
          /bin/bash -c "source /opt/ros/melodic/setup.bash"
          catkin config --extend /opt/ros/melodic
          catkin build
      #catkin_make -DCMAKE_BUILD_TYPE=Release
